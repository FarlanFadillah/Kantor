<% layout('pages/base_layout') %>
<div class="container py-5">
  <div class="card shadow-sm">
    <div class="card-body">
      <h1 class="mb-4">Form Peralihan Hak</h1>

      <form action="<%= form_action %>" method="POST" class="row g-3">
        <!-- No Akta -->
        <div class="col-md-6">
          <label for="no_akta" class="form-label">No. Akta</label>
          <input type="number" class="form-control" id="no_akta" name="no_akta"
            required value="<%= form_data?.no_akta || '' %>">
        </div>

        <!-- Tanggal Akta -->
        <div class="col-md-6">
          <label for="tgl_akta" class="form-label">Tanggal Akta</label>
          <input type="date" class="form-control" id="tgl_akta" name="tgl_akta"
            value="<%= form_data?.tgl_akta ? form_data.tgl_akta.toISOString().split('T')[0] : '' %>">
        </div>

        <!-- Produk -->
        <div class="col-md-6">
          <label for="produk" class="form-label">Produk</label>
          <select class="form-select" id="produk" name="produk" required>
            <option value="">-- Pilih --</option>
            <% ['AJB','HIBAH','WARIS','APHB'].forEach(opt => { %>
              <option value="<%= opt %>" <%= form_data?.produk === opt ? 'selected' : '' %>><%= opt %></option>
            <% }) %>
          </select>
        </div>

        <!-- Alas Hak -->
        <%-include('../partials/alashak_search')%>

        <!-- BPHTB -->
        <div class="col-md-6">
          <label for="bphtb_id" class="form-label">BPHTB ID</label>
          <div class="input-group">
            <input type="number" class="form-control" id="bphtb_id" name="bphtb_id"
            value="<%= form_data?.bphtb_id || '' %>">
            <a id="find-bphtb" class="btn btn-outline-primary">Find</a>
          </div>
        </div>
        

        <!-- BPHTB LIST -->
        <div class="modal modal-lg fade" tabindex="-1" id="bphtb_list">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">BPHTB List</h5>
                <button type="button" id="btn-close-bphtb-modal" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">NOP</th>
                      <th scope="col">Alas Hak</th>
                      <th scope="col">Produk</th>
                      <th scope="col">Wajib Pajak</th>
                      <th scope="col">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="bphtb_table_body">
                    
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Checkbox Options -->
        <div class="col-md-12">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" id="pph" name="pph" value="true"
              <%= form_data?.pph ? 'checked' : '' %>>
            <label class="form-check-label" for="pph">PPH</label>
          </div>

          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" id="ceking_shm" name="ceking_shm" value="true"
              <%= form_data?.ceking_shm ? 'checked' : '' %>>
            <label class="form-check-label" for="ceking_shm">Ceking SHM</label>
          </div>

          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" id="znt_shm" name="znt_shm" value="true"
              <%= form_data?.znt_shm ? 'checked' : '' %>>
            <label class="form-check-label" for="znt_shm">ZNT SHM</label>
          </div>
        </div>

        <!-- Catatan -->
        <div class="col-12">
          <label for="catatan" class="form-label">Catatan</label>
          <textarea class="form-control" id="catatan" name="catatan"><%= form_data?.catatan || '' %></textarea>
        </div>

        <!-- ==================== Bagian Relasi ==================== -->

        <!-- Penerima Hak -->
        <div class="px-3">
          <div class="row border border-primary rounded">
            <h3>Penerima Hak</h3>
            <%-include('../partials/client_search', {
              extraContent : `
              <a class="btn btn-primary add-list" data-field="penerima_hak" id="add_penerima_hak_list">+</a>
              `
            })%>
  
            <%-include('../partials/client_list_form', {
              field : 'penerima_hak'
            }) %>
          </div>
        </div>

        <!-- Pihak Persetujuan -->
        <div class="px-3">
        <div class="row border border-primary rounded">
            <h3>Pihak Persetujuan</h3>
            <%-include('../partials/client_search', {
              extraContent : `
              <a class="btn btn-primary add-list" data-field="pihak_persetujuan" id="add_pihak_persetujuan_list">+</a>
              `
            })%>

            <%-include('../partials/client_list_form', {
              field : 'pihak_persetujuan'
            }) %>
          </div>
        </div>


        <!-- Kuasa Jual -->
        <div class="px-3">
          <div class="row border border-primary rounded">
            <h3>Kuasa Jual</h3>
            <%-include('../partials/client_search', {
              extraContent : `
              <a class="btn btn-primary add-list" data-field="kuasa_jual" id="add_kuasa_jual_list">+</a>
              `
            })%>

            <%-include('../partials/client_list_form', {
              field : 'kuasa_jual'
            }) %>
          </div>
        </div>

        <!-- Kuasa Beli -->
        <div class="px-3">
          <div class="row border border-primary rounded">
            <h3>Kuasa Beli</h3>
            <%-include('../partials/client_search', {
              extraContent : `
              <a class="btn btn-primary add-list" data-field="kuasa_beli" id="add_kuasa_beli_list">+</a>
              `
            })%>

            <%-include('../partials/client_list_form', {
              field : 'kuasa_beli'
            }) %>
          </div>
        </div>
        <div class="col-12" id="msgs">


        </div>

        <div class="col-12">
          <button type="submit" class="btn btn-primary">Simpan</button>
          <a href="/admin/dashboard" class="btn btn-outline-primary">Dashboard</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="/js/client_search.js"></script>
<script src="/js/alashak_search.js"></script>
<script src="/js/alihhak_form_page.js"></script>
